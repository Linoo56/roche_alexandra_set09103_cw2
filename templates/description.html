{% extends "main.html" %}
{% block style %}
<style>

  td:nth-child(2){
    text-align-last: end;
  }
  .google-maps {
    border: 0;
    width: -webkit-fill-available;
    height: 400px;
  }
  dd {
    margin-bottom: 5px;
  }
  tr .sub{
    font-weight: normal;
  }
  .school-logo{
    text-align: center;
    margin: 20px;
    margin-bottom: 30px;
  }
  .heart-container span{
    font-size: x-large;
  }
  .dl-horizontal.school dd{
    margin-left: 110px
  }
  .dl-horizontal.school dt{
    text-align: left;
    padding-left: 30px;
    width: 110px
  }
  .heart-container{
    padding:10px 0 0 10px;
    text-align:center;
  }
</style>
{% endblock %}

{% block content %}
    <div class="container page">
      <div class="header">
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-info">
              <h3>{{ message }}</h3>
            </div>
          {% endfor %}
        {% endif %}	
      {% endwith %}  
        <h1>{{ school.name }}</h1> 
        <h2>Detailled information :</h2>
      </div>
      <div class="panel panel-default">
        <div class="panel-body">
          <div class="row">
	    <div class="col-md-1 heart-container">
	    {% if fav %}
	      <a href="{{ url_for('del_school_favorite', schid=school.schid) }}"><span class="glyphicon glyphicon-heart" aria-hidden="true"></span></a>
	    {% else %}	
	      <a href="{{ url_for('add_school_favorite', schid=school.schid) }}"><span class="glyphicon glyphicon-heart-empty" aria-hidden="true"></span></a>
	    {% endif %}
	    </div>
            <div class="col-md-5">
              <div class="school-logo"><img src="{{ url_for('static', filename='img/school'+school.schid|string+'.jpg') }}"></div>
	      <dl class="dl-horizontal school">
		<dt>Name :</dt>
		<dd>{{ school.name }}</dd>
		<dt>City :</dt>
		<dd>{{ school.city }}</dd>
		{% if school.district != None %}
		  <dt>District :</dt>
		  <dd>{{ school.district }}</dd>
		{% endif %}
		<dt>Website :</dt>
		<dd><a href="{{ school.website }}">{{ school.website }}</a></dd>
	      </dl>
	    </div>
              <div class="col-md-6">
                <iframe class="google-maps" src="{{school.googleLink}}" allowfullscreen="allowfullscreen"></iframe>
              </div>
            </div>
        </div>
      </div>
      {% if programs|length %}
      <div class="panel with-nav-tabs panel-default">
         <div class="panel-heading">
           <ul class="nav nav-tabs">
	   {% for program in programs %}
             <li id="tabs"><a href="#tab{{loop.index}}default" data-toggle="tab">Program {{loop.index}}</a></li>
           {% endfor %}
           </ul>
         </div>
	 <div class="panel-body">
	   <div class="tab-content">
	   {% for program in programs%}
	     <div class="tab-pane fade" id="tab{{loop.index}}default">
               <div class="row">
	         <div class="col-md-1 heart-container">
	           <span class="glyphicon glyphicon-heart-empty" aria-hidden="true">
	         </div>
                 <div class="col-md-5">
	           <dl class="dl-horizontal">
		     <dt>Duration :</dt>
		     <dd>{{ program.duration }} months</dd>
		     {% if program.accoType != ''%}
		     <dt>Accomodation type :</dt>
		     <dd>{{ program.accoType }}</dd>
		     {% endif %}
		     <dt>Visa Support :</dt>
		     <dd>{{ program.visaSupp }}</dd>
		     <dt>EJU preparation :</dt>
		     <dd>{{ program.eju }}</dd>
		     <dt>JLPT preparation :</dt>
		     <dd>{{ program.jlpt }}</dd>
		     <dt>Additionnal notes :</dt>
		     <dd>{{ program.notes }}</dd>
	           </dl>
	         </div>
                 <div class="col-md-6">
	           <div class="panel panel-default">
                     <div class="panel-heading">Price</div>
                       <table class="table">
                         <tbody>
			   <tr>
                   <td><b>Application fee :</b></td>
                   <td>{{ format_price(program.appliFee) }} yens</td>
               </tr>
			   <tr>
                             <td><b>Course fee :</b></td>
                             <td>{{ format_price(program.courseFee) }} yens</td>
                           </tr>
			   {% if program.accoFee is number %}
			   <tr>
                             <td><b>Accomodation fee :</b></td>
                             <td>{{ format_price(program.accoFee) }} yens</td>
                           </tr>
			   {% else %}
			   <tr>
                             <td><b>Accomodation fee :</b></td>
                             <td>Not calculated</td>
                           </tr>
			   {% endif %}
			   {% if program.accoFee is number %}
                           <tr>
                             <td><b>Total fee :</b></td>
                             <td>{{ format_price(program.appliFee+program.courseFee+program.accoFee) }} yens</td>
                           </tr>
			   <tr>
                             <td><b>Price per month (yens):</b></td>
                             <td>{{ format_price((program.appliFee+program.courseFee+program.accoFee)/program.duration) }} yens</td>
                           </tr>
			   <tr>
                             <td><b>Price per month (euros):</b></td>
                             <td>{{ format_price(((program.appliFee+program.courseFee+program.accoFee)/program.duration)/130) }} euros</td>
                           </tr>
			   {% endif %}
                         </tbody>
                       </table>
                     </div>
                   </div>
	         </div>
               </div>
	   {% endfor %}
	   </div>
	 </div>
       {% endif %}

      </div>
     {% if session['logged_in'] %}
       <button type="button" class="btn btn-primary btn-block" href="{{ url_for('submit_review', schid=school.schid) }}">You can submit a review of the school</button>
     {% endif %}
    </div>
{% endblock %}

{% block scripts%}
<script>
var x = document.querySelectorAll("li#tabs");
x[0].setAttribute("class", "active"); 
var y = document.querySelectorAll("div:first-child.tab-pane.fade")
y[0].setAttribute("class", "tab-pane fade in active")
</script> 
{% endblock %}
